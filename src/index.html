<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="blog-demo-gpt-s-viewability-and-impression-timing">
  <title>A simple playground page for GPT (Google Publisher Tools) lifecycle events for display ads.</title>
  <link rel="stylesheet" href="assets/css/normalize.css">
  <link rel="stylesheet" href="assets/css/main.css">
  <script async src='https://securepubads.g.doubleclick.net/tag/js/gpt.js'></script>
  <script>window.googletag = window.googletag || {cmd: []};</script>
  <script src="assets/js/demotag.js"></script>
  <script src="assets/js/gpt-slot-definitions.js"></script>
  <script src="assets/js/main.js"></script>
</head>
<body>
  <div class="grid-container">
    <!-- site header -->
    <header class="grid-header">
      <nav class="navbar">
        <div class="navbar-brand">
          <h1><a href="./index.html">GPT's Event Lifecycle</a></h1>
          <p>GPT's Viewability and Impression Timing</p>
        </div>
        <ul class="navbar-items">
          <li class="navbar-item">
            <a href="https://github.com/xkema/blog-demo-gpt-s-viewability-and-impression-timing" target="_blank">@github</a>
          </li>
          <li class="navbar-item">
            <a href="https://github.com/xkema/blog-demo-gpt-s-viewability-and-impression-timing" target="_blank">@post</a>
          </li>
        </ul>
      </nav>
    </header>
    <!-- timelines wrapper -->
    <section class="grid-entrance">
      <h1>Before You Begin!</h1>
      <p class="warning-box">This is a demo for developers whose main development focus is display ads. This is an uncommon topic for most of the front end developers. If you're not working for a digital publisher, I can't say there is much for you here, sadly. So here is a good place to decide leaving and finding something funnier to read for yourself!</p>
      <hr>
      <p><b>Ad Blocker Users</b>: You should always be using ad/tracker blockers. <u>But just for this demo you must disable ad blockers temporarily</u>. Because this demo is all about ads.</p>
      <p><b>Users Without Ad Blocker</b>: You should definitely use an ad/tracker blocker for personal stuff! See some starter <a href="#privacy-matters">links</a> at the end of the page.</p>
    </section>
    <!-- timelines wrapper -->
    <section class="grid-graph">
      <div class="pin-title">
        <h1>Event Timelines</h1>
        <button type="button" class="pin-button pin-timelines" title="pin/unpin panel">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="currentColor">
            <path fill-rule="evenodd" d="M4.456.734a1.75 1.75 0 012.826.504l.613 1.327a3.081 3.081 0 002.084 1.707l2.454.584c1.332.317 1.8 1.972.832 2.94L11.06 10l3.72 3.72a.75.75 0 11-1.061 1.06L10 11.06l-2.204 2.205c-.968.968-2.623.5-2.94-.832l-.584-2.454a3.081 3.081 0 00-1.707-2.084l-1.327-.613a1.75 1.75 0 01-.504-2.826L4.456.734zM5.92 1.866a.25.25 0 00-.404-.072L1.794 5.516a.25.25 0 00.072.404l1.328.613A4.582 4.582 0 015.73 9.63l.584 2.454a.25.25 0 00.42.12l5.47-5.47a.25.25 0 00-.12-.42L9.63 5.73a4.581 4.581 0 01-3.098-2.537L5.92 1.866z"></path>
          </svg>
        </button>
      </div>
      <div class="timelines">
        <!-- timelines -->
      </div>
    </section>
    <!-- main content -->
    <main class="grid-main">
      <h1>GPT Events</h1>
      <p>From requesting ads to counting them as impressions, <abbr title="Google Publisher Tools">GPT</abbr> library triggers various events to inform page about current slot statuses. GPT options <code>enableSingleRequest</code> and <code>enableLazyLoad</code> change event triggering times in various ways.</p>
      <div class="form-wrapper">
        <h2>Customization Form</h2>
        <!-- customization form -->
        <form class="page-settings">
          <div class="option">
            <label for="enableSingleRequest">enableSingleRequest</label>
            <div class="input-wrapper"><input type="checkbox" name="enableSingleRequest" id="enableSingleRequest"></div>
            <div class="current-value"><span>disabled</span></div> 
          </div>
          <div class="option">
            <label for="enableLazyLoad">enableLazyLoad</label>
            <div class="input-wrapper"><input type="checkbox" name="enableLazyLoad" id="enableLazyLoad"></div>
            <div class="current-value"><span>disabled</span></div> 
          </div>
          <div class="option sub-option">
            <label for="fetchMarginPercent">fetchMarginPercent</label>
            <div class="input-wrapper"><input type="range" min="0" max="500" value="0" step="100" name="fetchMarginPercent" id="fetchMarginPercent"></div>
            <div class="current-value"><span>0</span></div> 
          </div>
          <div class="option sub-option">
            <label for="renderMarginPercent">renderMarginPercent</label>
            <div class="input-wrapper"><input type="range" min="0" max="500" value="0" step="100" name="renderMarginPercent" id="renderMarginPercent"></div>
            <div class="current-value"><span>0</span></div> 
          </div>
          <div class="submit">
            <button type="submit">Reload Page</button>
          </div>
        </form>
      </div>
      <!-- customization form details and description -->
      <h2>Customization Info & Definitions</h2>
      <div class="form-info">
        <p>Use the form above to change GPT options. Clicking submit button will reload the page with selected configuration.</p>
        <hr>
        <p>Follow timelines to observe what changes on selected GPT configuration. Here are some hints for GPT options available:</p>
        <ul>
          <li>
            <p><code>enableSingleRequest</code> Combines fetching of all ad requests into a a single HTTP Request. <a href="https://developers.google.com/doubleclick-gpt/reference#boolean-enablesinglerequest" target="_blank">@docs</a></p>
            <p>Timing info on the timelines for <code>slotRequested</code> events might differ event if this mode is enabled. Because timeline values are slot definition times not the request times.</p>
          </li>
          <li>
            <p><code>enableLazyLoad</code> Enables GPT's build in lazyloading feature. <a href="https://developers.google.com/doubleclick-gpt/reference#googletag.PubAdsService_enableLazyLoad" target="_blank">@docs</a></p>
            <p>Lazyloading helps with reducing page load time by pausing initial requests on page load. It also heps with closing the gap between impressions and viewability metrics.</p>
          </li>
          <li>
            <p><code>fetchMarginPercent</code> Start fetching before entering viewport. <a href="https://developers.google.com/doubleclick-gpt/reference#googletag.PubAdsService_enableLazyLoad" target="_blank">@docs</a></p>
            <p>Use fetch margin to decide when to send slot requests. <code>0</code> for right after entering the viewport, <code>100</code> for before <code>1vw</code> etc...</p>
          </li>
          <li>
            <p><code>renderMarginPercent</code> Start rendering before entering viewport. <a href="https://developers.google.com/doubleclick-gpt/reference#googletag.PubAdsService_enableLazyLoad" target="_blank">@docs</a></p>
            <p>Postpones rendering of slot content which also means postponing impression requests until slot enters the render margin percent.</p>
          </li>
        </ul>
        <hr>
      <p><code>googletag.pubads().refresh()</code> method doesn't update timelines to keep things simple. This demo only shows initial events for each slot.</p>
      </div>
      <!-- predefined setups and description -->
      <h2>Predefined setups</h2>
      <div class="predefined-setups">
        <ul>
          <li>
            <p><a href="./index.html?enableLazyLoad=on&fetchMarginPercent=0&renderMarginPercent=0">GPT "enableLazyLoad" (default lazyloading setup)</a></p>
            <p>This is the basic setup for GPT's built-in <code>enableLazyLoad</code> feature. Expected outcome is empty timelines until each slot enters into the viewport. Each timeline will be filled individually at this setup because <code>enableSingleRequest</code> option is not enabled.</p>
            <p>There will be 2 separate network requests for each ad which you can see at your devtool's network panel by filtering requests with <code>ads?</code> keyword.</p>
          </li>
          <li>
            <p><a href="./index.html?enableSingleRequest=on&enableLazyLoad=on&fetchMarginPercent=0&renderMarginPercent=0">GPT "enableLazyLoad" with "enableSingleRequest" enabled</a></p>
            <p>When <code>enableSingleRequest</code> is enabled along with <code>enableLazyLoad</code> option, individual behaviour above will be interrupted. With this setup ad requests will be merged by GPT.</p>
            <p>This time there will be a single network request for all ad slots at devtool's network panel. (Again, use <code>ads?</code> keyword as a filter.)</p>
            <p>A further note, lazy fetching with <abbr title="Single Request Architecture">SRA</abbr> (<code>enableSingleRequest</code>) will only work if all slots are out of viewport at initial page load. Otherwise both slots will be fetched initially at page load.</p>
            <p><b>Hint</b>: Resize your browser window vertically to observe both. If both slots are out of the viewport, there will be 2 empty timelines initially. Else there will be a filled timelime for top slot and a <code>slotRequested</code> <small>&</small> <code>slotResponseReceived</code> couple for bottom slot.</p>
          </li>
          <li>
            <p><a href="./index.html">Basic setup without "enableSingleRequest" and "enableLazyLoad"</a></p>
            <p>This is the initial setup for this demo page. Without single request and lazyloading. </p>
          </li>
        </ul>
      </div>
    </main>
    <aside class="grid-aside-top">
      <!-- top slot description -->
      <h1>Top Slot</h1>
      <div>
        <p>This page has 2 ad slots on sidebar element. One is at top <code>sidebar-top-slot</code> and the other one is at bottom <code>sidebar-bottom-slot</code>.</p>
        <p>There is a seperator between these two ad slots to push bottom slot out of first viewport. (to observe lazyloading behaviour clearly)</p>
      </div>
      <!-- top slot -->
      <div id='sidebar-top-slot'>
        <script>
          googletag.cmd.push(function () {
            googletag.display('sidebar-top-slot');
          });
        </script>
      </div>
    </aside>
    <aside class="grid-aside-middle">
      <div class="sidebar-separator">
        &uarr;<br>separator<br>&darr;
      </div>
    </aside>
    <aside class="grid-aside-bottom">
      <h1>Bottom Slot</h1>
      <p>This slot will be used to observe lazyload behaviour.</p>
      <!-- bottom slot -->
      <div id='sidebar-bottom-slot'>
        <script>
          googletag.cmd.push(function () {
            googletag.display('sidebar-bottom-slot');
          });
        </script>
      </div>
    </aside>
    <section class="grid-privacy">
      <div class="privacy-matters-wrapper">
        <h1 id="privacy-matters">Ad/Tracker Blockers I Use</h1>
        <ul>
          <li><a href="https://www.mozilla.org/en-US/firefox/" target="_blank">mozilla.org/en-US/firefox</a></li>
          <li><a href="https://duckduckgo.com/" target="_blank">duckduckgo.com</a></li>
          <li><a href="https://getadblock.com/" target="_blank">getadblock.com</a></li>
          <li><a href="https://brave.com/" target="_blank">brave.com</a></li>
        </ul>
        <p>The list above is still the beginners stuff. Check <a href="https://www.privacytools.io/browsers/">privacytools.io/browsers</a> for better adjusting yourself with details.</p>
      </div>
    </section>
    <footer class="grid-footer">
      <div class="outro">
        <a href="https://github.com/xkema/blog-demo-gpt-s-viewability-and-impression-timing" target="_blank">@github</a>
        <a href="https://github.com/xkema/blog-demo-gpt-s-viewability-and-impression-timing" target="_blank">@post</a>
      </div>
    </footer>
  </div>
</body>
</html>